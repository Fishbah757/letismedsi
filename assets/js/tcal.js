function f_tcalGetHTML(a){var b=f_tcalGetInputs(!0);if(b){var c=A_TCALCONF.cssprefix,d=A_TCALCONF.format,e=f_tcalParseDate(A_TCALCONF.today,A_TCALCONF.format);e||(e=f_tcalResetTime(new Date));var f=f_tcalParseDate(b.value,d);f||(f=f_tcalParseDate(A_TCALCONF.selected,A_TCALCONF.format)),f||(f=new Date(e)),a=a?f_tcalResetTime(a):new Date(f);var g=new Date(a);g.setDate(1),g.setDate(1-(7+g.getDay()-A_TCALCONF.weekstart)%7);for(var h,i='<table id="'+c+'Controls"><tbody><tr>'+(A_TCALCONF.yearscroll?'<td id="'+c+'PrevYear" '+f_tcalRelDate(a,-1,"y")+' title="'+A_TCALCONF.prevyear+'"></td>':"")+'<td id="'+c+'PrevMonth"'+f_tcalRelDate(a,-1)+' title="'+A_TCALCONF.prevmonth+'"></td><th>'+A_TCALCONF.months[a.getMonth()]+" "+a.getFullYear()+'</th><td id="'+c+'NextMonth"'+f_tcalRelDate(a,1)+' title="'+A_TCALCONF.nextmonth+'"></td>'+(A_TCALCONF.yearscroll?'<td id="'+c+'NextYear"'+f_tcalRelDate(a,1,"y")+' title="'+A_TCALCONF.nextyear+'"></td>':"")+'</tr></tbody></table><table id="'+c+'Grid"><tbody><tr>',j=0;j<7;j++)i+="<th>"+A_TCALCONF.weekdays[(A_TCALCONF.weekstart+j)%7]+"</th>";i+="</tr>";for(var k,m=new Date(g);m.getMonth()==a.getMonth()||m.getMonth()==g.getMonth();){i+="<tr>";for(var n=0;n<7;n++)h=[],k=m.getDate(),m.getMonth(),m.getMonth()!=a.getMonth()&&(h[h.length]=c+"OtherMonth"),0!=m.getDay()&&6!=m.getDay()||(h[h.length]=c+"Weekend"),m.valueOf()==e.valueOf()&&(h[h.length]=c+"Today"),m.valueOf()==f.valueOf()&&(h[h.length]=c+"Selected"),i+="<td"+f_tcalRelDate(m)+(h.length?' class="'+h.join(" ")+'">':">")+k+"</td>",m.setDate(++k);i+="</tr>"}return i+="</tbody></table>"}}function f_tcalRelDate(a,b,c){var c="y"==c?"FullYear":"Month",d=new Date(a);return b&&(d["set"+c](a["get"+c]()+b),d.getDate()!=a.getDate()&&d.setDate(0)),' onclick="f_tcalUpdate('+d.valueOf()+(b?",1":"")+')"'}function f_tcalResetTime(a){return a.setMilliseconds(0),a.setSeconds(0),a.setMinutes(0),a.setHours(12),a}function f_tcalCancel(){var a=A_TCALCONF.cssprefix,b=document.getElementById(a);b&&(b.style.visibility="");for(var c=f_tcalGetInputs(),d=0;d<c.length;d++)f_tcalRemoveClass(c[d],a+"Active")}function f_tcalUpdate(a,b){var c=f_tcalGetInputs(!0);if(c){d_date=new Date(a);var d=A_TCALCONF.cssprefix;if(b){var e=document.getElementById(d);if(!e||"visible"!=e.style.visibility)return;e.innerHTML=f_tcalGetHTML(d_date,c)}else c.value=f_tcalGenerateDate(d_date,A_TCALCONF.format),f_tcalCancel()}}function f_tcalOnClick(){var a=A_TCALCONF.cssprefix,b=a+"Active",c=f_tcalHasClass(this,b);if(f_tcalCancel(),!c){f_tcalAddClass(this,b);var d=f_getPosition(this,"Left"),e=f_getPosition(this,"Top")+this.offsetHeight,f=document.getElementById(a);f||(f=document.createElement("div"),f.onselectstart=function(){return!1},f.id=a,document.getElementsByTagName("body").item(0).appendChild(f)),f.innerHTML=f_tcalGetHTML(null),f.style.top=e+"px",f.style.left=d+this.offsetWidth-f.offsetWidth+"px",f.style.visibility="visible"}}function f_tcalParseDate(a,b){if(a){for(var c,d="^",e={},g=0,h=0;h<b.length;h++)c=b.charAt(h),A_TCALTOKENS_IDX[c]?(e[c]=++g,d+="("+A_TCALTOKENS_IDX[c].r+")"):d+=" "==c?"\\s":(c.match(/[\w\d]/)?"":"\\")+c;var i=new RegExp(d+"$");if(a.match(i)){var j,k=f_tcalResetTime(new Date);for(k.setDate(1),h=0;h<A_TCALTOKENS.length;h++)c=A_TCALTOKENS[h].t,e[c]&&(j=RegExp["$"+e[c]],k=A_TCALTOKENS[h].p(k,j));return k}}}function f_tcalGenerateDate(a,b){for(var c,d="",e=0;e<b.length;e++)c=b.charAt(e),d+=A_TCALTOKENS_IDX[c]?A_TCALTOKENS_IDX[c].g(a):c;return d}function f_tcalGetInputs(a){var c,b=document.getElementsByTagName("input"),e=[];for(n=0;n<b.length;n++)if(c=b[n],c.type&&"text"==c.type&&f_tcalHasClass(c,"tcal")){if(a&&f_tcalHasClass(c,A_TCALCONF.cssprefix+"Active"))return c;e[e.length]=c}return a?null:e}function f_tcalHasClass(a,b){var c=a.className;if(!c)return!1;for(var d=c.split(" "),e=0;e<d.length;e++)if(d[e]==b)return!0;return!1}function f_tcalAddClass(a,b){if(!f_tcalHasClass(a,b)){var c=a.className;a.className=(c?c+" ":"")+b}}function f_tcalRemoveClass(a,b){var c=a.className;if(!c||-1==c.indexOf(b))return!1;for(var d=c.split(" "),e=[],f=0;f<d.length;f++)d[f]!=b&&(e[e.length]=d[f]);return a.className=e.join(" "),!0}function f_getPosition(a,b){for(var d,c=0,e=a;e;)d=e["offset"+b],c+=d,e=e.offsetParent;for(e=a;e!=document.body;)d=e["scroll"+b],d&&"scroll"==e.style.overflow&&(c-=d),e=e.parentNode;return c}function f_tcalInit(){if(document.getElementsByTagName){for(var a,b=f_tcalGetInputs(),c=0;c<b.length;c++)a=b[c],a.onclick=f_tcalOnClick,f_tcalAddClass(a,A_TCALCONF.cssprefix+"Input");for(window.A_TCALTOKENS_IDX={},c=0;c<A_TCALTOKENS.length;c++)A_TCALTOKENS_IDX[A_TCALTOKENS[c].t]=A_TCALTOKENS[c]}}function f_tcalAddOnload(a){if(document.addEventListener)window.addEventListener("load",a,!1);else if(window.attachEvent)window.attachEvent("onload",a);else{var b=window.onload;"function"!=typeof window.onload?window.onload=a:window.onload=function(){b(),a()}}}var A_TCALCONF={cssprefix:"tcal",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],longwdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],yearscroll:!0,weekstart:0,prevyear:"Предыдущий год",nextyear:"Следующий год",prevmonth:"Предыдущий месяц",nextmonth:"Следующий месяц",format:"d/m/Y"},A_TCALTOKENS=[{t:"Y",r:"19\\d{2}|20\\d{2}",p:function(a,b){return a.setFullYear(Number(b)),a},g:function(a){return a.getFullYear()}},{t:"m",r:"0?[1-9]|1[0-2]",p:function(a,b){return a.setMonth(Number(b)-1),a},g:function(a){var b=a.getMonth()+1;return(b<10?"0":"")+b}},{t:"F",r:A_TCALCONF.months.join("|"),p:function(a,b){for(var c=0;c<12;c++)if(A_TCALCONF.months[c]==b)return a.setMonth(c),a},g:function(a){return A_TCALCONF.months[a.getMonth()]}},{t:"d",r:"0?[1-9]|[12][0-9]|3[01]",p:function(a,b){return a.setDate(Number(b)),a.getDate()!=b&&a.setDate(0),a},g:function(a){var b=a.getDate();return(b<10?"0":"")+b}},{t:"j",r:"0?[1-9]|[12][0-9]|3[01]",p:function(a,b){return a.setDate(Number(b)),a.getDate()!=b&&a.setDate(0),a},g:function(a){return a.getDate()}},{t:"l",r:A_TCALCONF.longwdays.join("|"),p:function(a,b){return a},g:function(a){return A_TCALCONF.longwdays[a.getDay()]}},{t:"S",r:"st|nd|rd|th",p:function(a,b){return a},g:function(a){return n_date=a.getDate(),n_date%10==1&&11!=n_date?"st":n_date%10==2&&12!=n_date?"nd":n_date%10==3&&13!=n_date?"rd":"th"}}];f_tcalAddOnload(f_tcalInit);